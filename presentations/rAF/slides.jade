section
    h2 Throttling in the browser...
    h2 done right

section
    h2 Agenda
    ul
        li How you might throttle
        li How you should throttle
        li Live demo

section
    h2 About me

    h5 Name
    p Reto Schl√§pfer

    h5 Work
    p React.js/Flux & Finance related backend stuff in Python at #[i Bluevalor AG]

    h5 Blog
    p www.code-experience.com

    h5 Twitter
    p: i @Retolements

    h5 GitHub
    p: i Retozi

section
    h2 Why throttling

    div
        p Because some events fire very often! (mousemove, scroll, resize)

        div.demo-box#mousemove-counter


section

    h2 Throttling via underscore

    pre
        code.hljs.javascript.
            var throtteledFun = _.throttle(onMouseClick, 1000 / 60);

            $(".foo").mousemove(throtteledFun);

section

    h2 Under the hood

    pre
        code.hljs.javascript.
            function throttle(func, frameRate) {
                var _wait = false;
                return function() {
                    if (_wait) {
                        return;
                    }

                    _wait = true;
                    setTimeout(function() {
                        _wait = false;
                        func();
                    }, frameRate);
                };
            }

section

    h2 Problems

    li static call rate

    li multiple throttlers are not bundled

    li call cycle is not synchronized with the browser reflow repaint cycle

    li runs even if animation is actually not visible


section

    h2 Solution:

    p: strong: i requestAnimationFrame

    li calls function every frame

    li batches calls

    li aligns with browser reflow repaint cycle

    li does not run in tabs that are not visible


section

    h2 A working throttler

    pre
        code.hljs.javascript.
            function throttle(func) {
                var _lastFun = func;
                return function() {
                    _lastFun = fun;
                    requestAnimationFrame(function() {
                        if (_lastFun) {
                            _lastFun();
                            _lastFun = null;
                        }
                    });
                };
            }



section

    h2 A (slightly) better throttler

    pre
        code.hljs.javascript.
            function throttle(func, frameRate) {
                var _wait = false;
                return function() {
                    if (_wait) {
                        return;
                    }
                    _wait = true;
                    requestAnimationFrame(function() {
                        _wait = false;
                        func();
                    }, frameRate);
                };
            }


section

    h2 Comparison


    div.demo-box#setTimeout
        div.green
        - var val = 0
        while val < 50
            div(class='blue' style="left: " + 15 * val + "px;")
            - val++

    div.demo-box#naive
        div.green
        div.blue

    div.demo-box#normal
        div.green
        div.blue
